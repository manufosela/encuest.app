// Script to generate firebase-config.js from environment variables
import { writeFileSync, mkdirSync } from 'fs';
import { dirname } from 'path';
import { fileURLToPath } from 'url';
import dotenv from 'dotenv';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Load environment variables
dotenv.config();

// Ensure the output directory exists
const outputPath = './public/lib/firebase-config.js';
const outputDir = dirname(outputPath);
try {
  mkdirSync(outputDir, { recursive: true });
} catch (err) {
  // Directory might already exist
}

// Template for firebase-config.js
const firebaseConfigTemplate = `// Firebase Configuration - Generated automatically
// DO NOT EDIT THIS FILE - It will be overwritten
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js';
import { getDatabase } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js';
import { getAuth } from 'https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js';

export const firebaseConfig = {
  apiKey: "${process.env.FIREBASE_API_KEY}",
  authDomain: "${process.env.FIREBASE_AUTH_DOMAIN}",
  databaseURL: "${process.env.FIREBASE_DATABASE_URL}",
  projectId: "${process.env.FIREBASE_PROJECT_ID}",
  storageBucket: "${process.env.FIREBASE_STORAGE_BUCKET}",
  messagingSenderId: "${process.env.FIREBASE_MESSAGING_SENDER_ID}",
  appId: "${process.env.FIREBASE_APP_ID}"
};

const app = initializeApp(firebaseConfig);
export const database = getDatabase(app);
export const auth = getAuth(app);
`;

try {
  writeFileSync(outputPath, firebaseConfigTemplate);
  console.log('✓ Firebase config generated successfully at', outputPath);
} catch (error) {
  console.error('✗ Error generating firebase config:', error);
  process.exit(1);
}